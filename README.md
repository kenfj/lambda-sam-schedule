# Lambda schedule example by AWS SAM and Terraform

* Setup Lambda with schedule event by SAM
* development using SAM and deploy using Terraform without S3


## Setup

```bash
# install AWS CLI, Docker and SAM CLI
brew install awscli
brew cask install docker
brew install aws-sam-cli
```

```bash
# install python env tools
brew install pyenv pipenv
echo 'eval "$(pyenv init -)"' >> ~/.bash_profile
echo 'eval "$(pipenv --completion)"' >> ~/.bash_profile
echo 'export PIPENV_VENV_IN_PROJECT=true' >> ~/.bash_profile
source ~/.bash_profile
```

```bash
# install python packages
cd sam-app/
pipenv install
pipenv install --dev
pipenv shell
python --version     # make sure you see Python 3.7.2 or later
# if you want to initialize
# sam init --name new-app --location sam-app --runtime python3.7
# cd new-app
# pipenv --python 3.7
# pipenv install -r src/requirements.txt
# pipenv install --dev -r src/requirements_dev.txt
# note: template.yaml default is python3.6
```


## Test

```bash
cd sam-app/
pipenv shell
# run unit test
python -m pytest tests/ -v
```


## Build and Run Locally

```bash
cd sam-app/
# the build command create files in
# .aws-sam/build/HelloWorldFunction/
sam build --use-container --region ap-northeast-1
# run lambda
sam local invoke HelloWorldFunction --event event.json
```


## Deploy Terraform Module

```bash
cd example
# deploy sample code
terraform plan
terraform apply
```


## Note: how to generate event.json

```bash
# to use Constant (JSON text)
# "{\"event_input\":\"something\"}"
# to generate cloudwatch schedule matched event
sam local generate-event cloudwatch scheduled-event
# the SAM init default event.json is generated by the below
sam local generate-event apigateway aws-proxy
```


## Reference

* https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-quick-start.html


----------
the_below_is_auto_generated_by_terraform-docs

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|:----:|:-----:|:-----:|
| app\_name | the app name | string | `"lambda_schedule_test"` | no |
| cloudwatch\_schedule | CloudWatch Events Schedule expression | string | `"rate(5 minutes)"` | no |

## Outputs

| Name | Description |
|------|-------------|
| lambda\_arn | Lambda arn |

